# ThreatLens AI — Comprehensive Implementation Plan

---

## Team Structure

**4 People, 56 Hours**

| Person | Role | Responsibilities |
|--------|------|-----------------|
| P1 | AI/ML Lead | Anomaly detection models, XAI (SHAP), correlation engine |
| P2 | Backend Lead | FastAPI, Kafka pipeline, database, sandbox integration |
| P3 | Frontend Lead | React dashboard, WebSockets, evidence gallery, timeline |
| P4 | Data & Security Lead | Data ingestion, RF signals, camera pipeline, attack simulation |

---

## Core Non-Negotiables

Before planning, these features **cannot be cut:**
- Multi-source ingestion (network, logs, camera, RF)
- AI anomaly detection per source
- Cross-domain correlation engine
- XAI explanations (SHAP + natural language)
- Evidence capture (screenshots, video frames, logs)
- Sandbox detonation
- Unified SOC dashboard with real-time alerts
- Blockchain evidence anchoring (differentiator)

---

## What Makes Us Different From Competitors

Before diving into implementation, here is our differentiation strategy:

**Most teams will build:**
- Basic OpenCV person detection
- Simple rule-based alerting
- Basic dashboard

**We will build:**
- **Behavioral DNA Profiling** — not just detecting anomalies but building a unique behavioral fingerprint per device, user, and network zone. Deviations from DNA trigger alerts, not just threshold breaches
- **Causal Attack Graph** — instead of a list of alerts, we render a live graph showing how events caused each other, visually mapping the attack path in real time using Neo4j
- **Blockchain-Anchored Evidence Chain** — every piece of forensic evidence gets a hash anchored on Polygon blockchain, making our evidence tamper-proof and legally credible
- **Attacker Intent Scoring** — beyond risk scoring, we classify attacker intent (espionage vs ransomware vs insider theft vs APT) using MITRE ATT&CK TTP matching
- **LLM-Powered SOC Copilot** — analyst can type "what happened in zone A last night?" and get a natural language answer backed by evidence, not just raw logs
- **Predictive Next-Move Engine** — if reconnaissance is detected, system predicts "lateral movement expected" before it happens, based on historical attack chain patterns

---

## System Architecture — Full Design

### High-Level Architecture

```
┌─────────────────────────────────────────────────────────────────┐
│                     DATA SOURCES                                │
├──────────────┬──────────────┬──────────────┬────────────────────┤
│   Network    │   Camera     │  RF Signals  │   Device Logs      │
│   Traffic    │   Feeds      │  Monitor     │   (Syslog/Auth)    │
│  (Zeek/pcap) │  (OpenCV +   │  (Kismet/    │   (Filebeat/       │
│              │   YOLOv8)    │   SDR)       │    Watchdog)       │
└──────┬───────┴──────┬───────┴──────┬───────┴────────┬───────────┘
       │              │              │                │
       └──────────────┴──────────────┴────────────────┘
                                │
                                ▼
┌─────────────────────────────────────────────────────────────────┐
│                    MESSAGE BROKER (Kafka)                       │
│         All events normalized and streamed as JSON              │
└──────────────────────────────┬──────────────────────────────────┘
                               │
                               ▼
┌─────────────────────────────────────────────────────────────────┐
│              BEHAVIORAL DNA ENGINE (NEW)                        │
│  • Build fingerprint per device/user/zone                       │
│  • Rolling 24hr baseline per entity                             │
│  • Flag deviations from DNA not just thresholds                 │
└──────────────────────────────┬──────────────────────────────────┘
                               │
                               ▼
┌─────────────────────────────────────────────────────────────────┐
│           PER-SOURCE AI ANOMALY DETECTION                       │
├────────────┬────────────┬────────────┬──────────────────────────┤
│  Network   │  Camera    │    RF      │    Logs                  │
│ Isolation  │ YOLOv8 +   │  Signal    │  Random Forest           │
│  Forest +  │ Zone Rules │  Deviation │  + LSTM sequence         │
│ Autoencoder│ + Behavior │  Detector  │  anomaly detector        │
└────────────┴────────────┴────────────┴──────────────────────────┘
                               │
                               ▼
┌─────────────────────────────────────────────────────────────────┐
│              CROSS-DOMAIN CORRELATION ENGINE                    │
│  • Temporal windowing (5-15 minute windows)                     │
│  • MITRE ATT&CK TTP pattern matching                            │
│  • Causal Attack Graph generation (Neo4j)                       │
│  • Attacker Intent Classification                               │
│  • Predictive Next-Move Engine                                  │
└──────────────────────────────┬──────────────────────────────────┘
                               │
                ┌──────────────┴──────────────┐
                ▼                             ▼
┌───────────────────────┐       ┌─────────────────────────────────┐
│  EVIDENCE CAPTURE     │       │  SANDBOX DETONATION             │
│  • Screenshots        │       │  • Docker isolated container     │
│  • Video frames       │       │  • Execute suspicious files      │
│  • Log snippets       │       │  • Screenshot every 2 seconds    │
│  • Packet captures    │       │  • Extract IOCs                  │
│  • File snapshots     │       │  • Behavioral verdict            │
└──────────┬────────────┘       └──────────────┬──────────────────┘
           │                                   │
           └──────────────┬────────────────────┘
                          │
                          ▼
┌─────────────────────────────────────────────────────────────────┐
│           BLOCKCHAIN EVIDENCE ANCHORING (Polygon)               │
│  • SHA-256 hash of every evidence artifact                      │
│  • Hash written to Polygon blockchain                           │
│  • Tamper-proof chain of custody                                │
│  • Verification API for legal/compliance use                    │
└──────────────────────────┬──────────────────────────────────────┘
                           │
                           ▼
┌─────────────────────────────────────────────────────────────────┐
│                    XAI MODULE                                   │
│  • SHAP feature importance per alert                            │
│  • Natural language explanation generation                      │
│  • Causal attack timeline reconstruction                        │
│  • Attacker intent classification output                        │
│  • Predictive next-move warning                                 │
└──────────────────────────┬──────────────────────────────────────┘
                           │
                           ▼
┌─────────────────────────────────────────────────────────────────┐
│                   SOC DASHBOARD                                 │
├─────────────────────────────────────────────────────────────────┤
│  • Real-time alert feed (WebSocket)                             │
│  • Causal attack graph visualization (Neo4j + D3.js)            │
│  • Evidence gallery (screenshots, video, logs, packets)         │
│  • Sandbox detonation report with screenshot sequence           │
│  • XAI explanation panel (SHAP charts + NL reasoning)           │
│  • LLM SOC Copilot chat interface                               │
│  • Blockchain verification badge per evidence item              │
│  • Predictive threat panel                                      │
│  • MITRE ATT&CK heatmap                                         │
└─────────────────────────────────────────────────────────────────┘
```

---

## Detailed Component Design

---

### Component 1: Data Ingestion Layer

**Network Traffic**
- Tool: Zeek (Bro) for flow analysis — generates structured logs from raw pcap
- Alternative for demo: Replay UNSW-NB15 or CIC-IDS2017 dataset using tcpreplay
- Extract: Flow metadata (src/dst IP, port, bytes, duration, protocol)
- Stream to Kafka topic: `network-events`

**Camera Feeds**
- Tool: OpenCV for RTSP stream capture
- Model: YOLOv8 for person detection + zone boundary rules
- Enhancement (differentiator): Add **re-identification module** using DeepSORT so the system tracks the same person across multiple cameras, not just detects a person in each frame independently
- Extract: Person bounding box, zone ID, timestamp, re-identification token
- Stream to Kafka topic: `camera-events`

**RF Signal Monitoring**
- Tool: Kismet with Software Defined Radio (SDR) dongle (RTL-SDR ~$25)
- Detects: Rogue WiFi access points, unknown Bluetooth devices, RF jammers, new device MAC addresses
- Enhancement: Maintain whitelist of known devices, flag any new RF signature
- Stream to Kafka topic: `rf-events`

**Device Logs**
- Tool: Filebeat → Logstash pipeline
- Sources: Auth logs (/var/log/auth.log), syslog, application logs, Windows Event Logs
- File Integrity: Python Watchdog library monitoring critical directories
- Stream to Kafka topic: `log-events`

**Data Normalization Schema (all sources → unified JSON)**
```json
{
  "event_id": "uuid",
  "source_type": "network|camera|rf|logs|file",
  "timestamp": "ISO8601",
  "host": "device identifier",
  "raw_data": {},
  "anomaly_score": 0.0,
  "zone": "server_room|lobby|network_cabinet",
  "severity": "low|medium|high|critical"
}
```

---

### Component 2: Behavioral DNA Engine (Key Differentiator)

**Concept:** Every entity in the system (device, user account, network zone, camera zone) gets a behavioral fingerprint built from its historical activity patterns.

**What gets profiled:**
- Device: Normal CPU usage, normal network destinations, normal login times, normal file access patterns
- User: Normal login hours, normal commands run, normal data volumes accessed
- Network Zone: Normal traffic volume, normal protocols, normal internal/external ratio
- Camera Zone: Normal occupancy hours, normal person count, normal movement patterns

**How it works:**
- Rolling 24-hour window of activity per entity
- Store mean and standard deviation for each behavioral metric
- Flag events that deviate beyond 2.5 sigma from established DNA
- DNA updates continuously using exponential moving average (not static baseline)

**Why this is better than threshold alerting:**
- A threshold alert fires if traffic exceeds 1GB — but what if that device normally transfers 900MB? DNA knows it's normal
- Threshold alerts have no memory — DNA remembers behavioral history
- DNA catches slow, low-and-slow attacks that never cross a single threshold

---

### Component 3: Per-Source AI Anomaly Detection

**Network Anomaly Detector**
- Model: Isolation Forest (unsupervised, no labeled data needed) + Autoencoder for deep pattern detection
- Features: bytes transferred, packet rate, connection duration, destination IP reputation, port number, protocol, time of day
- Training data: UNSW-NB15 dataset or first 24 hours of live network capture
- Output: Anomaly score 0-100 per flow

**Camera Anomaly Detector**
- Model: YOLOv8 for person detection
- Zone Rules Engine: Polygon-defined restricted zones, time-based access rules
- Re-ID: DeepSORT tracker assigns persistent ID to each person across frames
- Behavior Analysis: Loitering detection (person in zone > N minutes), crowd anomaly, running detection
- Output: Alert + bounding box + person re-ID token + zone violation type

**RF Anomaly Detector**
- Model: Simple statistical deviation from known device whitelist
- Detects: New unknown MAC/device, signal strength anomaly, jamming pattern (wideband interference spike)
- Output: Alert + device fingerprint + signal characteristics

**Log Anomaly Detector**
- Model: Random Forest for known attack patterns + LSTM for sequence anomaly detection
- Features: Failed login count, time between logins, command sequences, privilege level changes, file access patterns
- Training: Normal log data from lab environment or synthetic log generation
- Output: Anomaly score 0-100 per log event sequence

**File Integrity Monitor**
- Tool: Python Watchdog + SHA-256 hashing of critical files
- Detects: Unauthorized modification, mass file encryption (ransomware), deletion, permission changes
- Output: Alert + file path + change type + before/after hash

---

### Component 4: Cross-Domain Correlation Engine

**Temporal Windowing**
- Maintain sliding 5-minute and 15-minute event windows
- Any combination of events from 2+ sources within window → trigger correlation analysis
- Use Redis sorted sets for efficient time-window queries

**Correlation Rules (Example Set)**

```python
CORRELATION_RULES = [
    {
        "name": "Physical + Cyber Coordinated Attack",
        "conditions": [
            {"source": "camera", "event": "zone_violation", "zone": "server_room"},
            {"source": "logs", "event": "new_login", "window_minutes": 5},
            {"source": "network", "event": "large_transfer", "window_minutes": 10}
        ],
        "risk_multiplier": 1.8,
        "mitre_ttp": "T1078 + T1041",
        "intent": "data_exfiltration"
    },
    {
        "name": "Ransomware Deployment",
        "conditions": [
            {"source": "file", "event": "mass_encryption"},
            {"source": "network", "event": "c2_beaconing"},
            {"source": "sandbox", "verdict": "malicious"}
        ],
        "risk_multiplier": 2.0,
        "mitre_ttp": "T1486",
        "intent": "ransomware"
    }
    # 20+ more rules covering all attack scenarios
]
```

**Causal Attack Graph (Key Differentiator)**
- Every correlated event becomes a node in a Neo4j graph
- Edges represent causal/temporal relationships between events
- Graph grows in real time as attack progresses
- Exposed to frontend as interactive D3.js visualization
- Analyst can literally see the attack path unfold visually

**Attacker Intent Classifier**
- Input: Set of correlated events + MITRE TTPs matched
- Model: Multi-class classifier (Random Forest)
- Output classes: Ransomware | Data Exfiltration | APT | Insider Threat | Reconnaissance | Sabotage
- Trained on MITRE ATT&CK dataset of known TTP sequences per attack type

**Predictive Next-Move Engine**
- If reconnaissance detected → predict "expect exploitation attempt within 30 minutes"
- If initial access detected → predict "expect lateral movement"
- Based on Markov chain of historical attack stage progressions from MITRE ATT&CK
- Dashboard shows predictive warning banner before next stage occurs

---

### Component 5: Evidence Capture Module

**Automated Trigger:** Any event with anomaly score > 60 OR any correlated incident

**Evidence Types and Capture Methods:**

| Evidence | Capture Method | Storage |
|----------|---------------|---------|
| System screenshot | PyAutoGUI / Playwright | MinIO |
| Camera video clip | OpenCV — 5 sec before/after alert | MinIO |
| Log snippet | Elasticsearch query ±30 seconds | Elasticsearch |
| Network packets | tcpdump — last 1000 packets from flow | MinIO as .pcap |
| File snapshot | Copy file before/after modification | MinIO |

**Evidence Package Structure:**
```
incident_<id>/
├── metadata.json          # Incident details, risk score, timestamps
├── screenshots/           # System activity screenshots
├── video_clips/           # Camera evidence
├── logs/                  # Relevant log extracts
├── packets/               # Network packet captures
├── files/                 # Suspicious file copies
├── sandbox_report/        # Detonation results
└── blockchain_receipt.json # Hash + blockchain transaction ID
```

---

### Component 6: Sandbox Detonation

**Trigger:** Any suspicious file detected by file integrity monitor OR any file score > 70 in anomaly detection

**Sandbox Design:**
- Docker container with completely isolated network (no external egress)
- Pre-installed monitoring: auditd (Linux file/process monitoring), tcpdump (network), inotifywait (file changes)
- Screenshot capture: VNC server inside container + automated screenshot every 2 seconds
- Execution timeout: 120 seconds

**Detonation Workflow:**
1. Copy suspicious file into clean Docker container
2. Start all monitoring agents
3. Execute file
4. Capture for 120 seconds:
   - All file system changes
   - All process creations and terminations
   - All network connection attempts
   - Screenshot every 2 seconds (60 screenshots total)
5. Terminate container completely
6. Analyze collected data:
   - Extract IOCs (IPs, domains, file hashes, registry keys)
   - Classify behavior: BENIGN / SUSPICIOUS / MALICIOUS
   - Generate behavioral signature
7. Output structured report + screenshot gallery

**Evasion Resistance:**
- Randomize container hostname and MAC address (malware checks these)
- Add fake user activity (simulated mouse movements inside container)
- Vary execution timing (malware sometimes checks if it is run too fast)

---

### Component 7: Blockchain Evidence Anchoring

**Design:**
- Use Polygon blockchain (near-zero gas fees, fast confirmation)
- Web3.py Python library for blockchain interaction
- Only store SHA-256 hash on-chain (actual files stay in MinIO)

**Workflow:**
```
Evidence file created
        ↓
Calculate SHA-256 hash
        ↓
Submit hash to Polygon smart contract
        ↓
Receive transaction hash + block number
        ↓
Store blockchain receipt alongside evidence
        ↓
Dashboard shows "Verified ✓ | Block #XXXXXXX" badge
```

**Smart Contract (Simple):**
```solidity
contract EvidenceRegistry {
    mapping(bytes32 => uint256) public evidenceTimestamps;
    
    function registerEvidence(bytes32 evidenceHash) external {
        evidenceTimestamps[evidenceHash] = block.timestamp;
    }
    
    function verifyEvidence(bytes32 evidenceHash) 
        external view returns (bool, uint256) {
        uint256 timestamp = evidenceTimestamps[evidenceHash];
        return (timestamp != 0, timestamp);
    }
}
```

---

### Component 8: XAI Module

**SHAP Explanations:**
- For each ML model prediction, run SHAP to get feature importance
- Identify top 5 features that drove the anomaly score
- Render as horizontal bar chart in dashboard

**Natural Language Explanation Generator:**
- Template-based NLG system (no hallucination risk vs pure LLM)
- Templates per attack type filled with actual detected values
- Example output:
```
Risk Score: 94 — CRITICAL — Insider Data Theft

This incident was flagged because:
1. Camera (Score: 89): Unauthorized person detected in Server Room 
   at 02:03 AM — outside permitted hours (8AM-6PM). No badge scan recorded.
   
2. Logs (Score: 76): New SSH login from 192.168.1.157 at 02:04 AM.
   This IP has not logged in from this subnet before.
   
3. File Integrity (Score: 91): /var/db/customer_data.sql copied and 
   compressed at 02:05 AM by process: rsync (unusual for this host).
   
4. Network (Score: 88): 2.3 GB transfer to 203.0.113.5 at 02:06 AM.
   Destination has no prior history. Transfer rate 20x baseline.

Correlation: All 4 events within 4-minute window.
Intent Classification: DATA EXFILTRATION (confidence: 94%)
MITRE ATT&CK: T1078 (Valid Accounts) + T1041 (Exfiltration Over C2)
Predicted Next Move: Attacker may attempt to delete logs to cover tracks.
```

**LLM SOC Copilot:**
- Analyst types natural language question into chat interface
- LLM (local Ollama instance running Mistral/LLaMA) receives question + relevant event data as context
- LLM generates natural language response backed by actual system data
- No hallucination risk because LLM only summarizes data already retrieved by system
- Example: "What happened in the server room last night?" → LLM queries events, summarizes timeline in plain English

---

### Component 9: SOC Dashboard

**Page 1: Alert Feed**
- Live updating list of incidents sorted by risk score
- Color coding: Green/Yellow/Orange/Red
- Each card shows: Risk score, sources involved, timestamp, intent classification, predicted next move warning

**Page 2: Incident Detail**
- Top: Risk score gauge + severity + attacker intent badge
- Tab 1 — Timeline: Chronological correlated events with causal arrows
- Tab 2 — Causal Attack Graph: Interactive Neo4j-powered D3.js graph showing attack path
- Tab 3 — Evidence: Screenshot gallery, video player, log viewer, PCAP download link
- Tab 4 — Sandbox Report: Screenshot sequence carousel, IOC list, behavioral verdict
- Tab 5 — XAI: SHAP bar charts, natural language explanation, MITRE ATT&CK mapping
- Tab 6 — Blockchain: Evidence verification status, block number, transaction hash, verify button

**Page 3: Live Monitoring**
- Real-time network traffic chart
- Login attempt heatmap
- Camera zone activity map
- RF device presence map
- File modification events feed

**Page 4: SOC Copilot**
- Chat interface connected to local LLM
- Full event history as context
- Analyst can query, investigate, and get summaries conversationally

**Page 5: Threat Intelligence**
- IOC feed from all sandbox detonations
- MITRE ATT&CK heatmap (which TTPs triggered most)
- Geographic map of threat source IPs
- Attacker intent distribution chart

---

## Implementation Phases — 56 Hours

### Phase 1: Foundation (Hours 0-12)
**P2 (Backend):** Set up FastAPI skeleton, Kafka topics, Docker Compose, MinIO storage, basic database schemas

**P4 (Data):** Set up data ingestion for all 4 sources, normalize to unified JSON schema, get data flowing into Kafka, set up open datasets (UNSW-NB15 for network, synthetic logs)

**P1 (AI/ML):** Train Isolation Forest on network dataset, train Random Forest on log dataset, implement behavioral DNA baseline builder

**P3 (Frontend):** Set up React project, implement WebSocket connection, build basic alert feed UI shell

---

### Phase 2: Detection + Correlation (Hours 12-28)
**P1:** Integrate all anomaly detection models into pipeline, implement correlation engine with 10+ rules, build attacker intent classifier, implement SHAP explanations

**P2:** Build evidence capture module, integrate sandbox Docker container, implement Kafka consumer that triggers detection and correlation

**P4:** Integrate YOLOv8 camera pipeline, implement RF signal monitoring, implement file integrity monitor with Watchdog, run attack simulations to generate test data

**P3:** Build incident detail page, timeline view, evidence gallery, SHAP visualization components

---

### Phase 3: Differentiators (Hours 28-44)
**P1:** Implement predictive next-move engine, implement NLG explanation templates, integrate LLM Copilot (Ollama)

**P2:** Implement blockchain evidence anchoring (Polygon testnet), build Neo4j causal attack graph, build sandbox screenshot capture and IOC extraction

**P4:** Simulate all 3 key demo attack scenarios end-to-end, capture realistic test evidence, tune correlation rules based on simulation results

**P3:** Build causal attack graph D3.js visualization, build SOC Copilot chat UI, build blockchain verification panel, build predictive threat warning banner, MITRE ATT&CK heatmap

---

### Phase 4: Integration + Polish (Hours 44-56)
**All:** End-to-end integration testing across all components

**P1:** Tune anomaly thresholds, validate XAI outputs, ensure SHAP charts render correctly

**P2:** Performance optimization, ensure WebSocket updates are real-time, fix any pipeline bottlenecks

**P3:** UI polish, ensure all tabs load correctly, responsive design, fix any rendering issues

**P4:** Run final demo scenarios, record backup demo video in case of live demo issues, prepare attack simulation scripts for presentation

---

## Technology Decisions — Final Stack

| Layer | Technology | Why |
|-------|-----------|-----|
| Message Broker | Apache Kafka | Real-time streaming, handles all 4 sources |
| Network Detection | Zeek + Isolation Forest | Industry standard + unsupervised |
| Camera | OpenCV + YOLOv8 + DeepSORT | Re-ID is our differentiator |
| RF | Kismet + RTL-SDR | Real hardware signal detection |
| Logs | Filebeat + Random Forest + LSTM | Sequence-aware detection |
| Files | Python Watchdog + SHA-256 | Lightweight, event-driven |
| Correlation | Custom Python + Neo4j | Graph-based attack path |
| Sandbox | Docker + auditd + VNC | Lightweight, parallelizable |
| Blockchain | Polygon + Web3.py + Solidity | Low cost, fast, real Web3 |
| XAI | SHAP + Template NLG + Ollama | Explainable + no hallucination |
| Storage | MinIO + Elasticsearch + TimescaleDB | Evidence + logs + time-series |
| Backend | FastAPI + Redis | Fast, async, modern |
| Frontend | React + D3.js + Tailwind | Interactive graphs + clean UI |
| Real-time | WebSockets | Live dashboard updates |

---

## Demo Scenarios for Presentation

### Scenario A — Insider Threat (Primary Demo)
Live simulation showing all 4 sources triggering, correlating, evidence captured, blockchain anchored, XAI explains intent as "data exfiltration", copilot answers "what happened?" in plain English

### Scenario B — Ransomware with Distraction
Sandbox detonation screenshot sequence shown live, C2 IOC extracted and blacklisted, predictive engine warned about C2 callback before it happened

### Scenario C — APT Infiltration
Causal attack graph visualization shown growing in real time as each attack stage is detected, MITRE ATT&CK heatmap populates live

---

## Risk Mitigation

| Risk | Mitigation |
|------|-----------|
| RF hardware unavailable | Use simulated RF data / Kismet in monitor mode on WiFi |
| Blockchain too slow | Use Polygon Mumbai testnet, pre-anchor demo evidence |
| LLM too slow locally | Pre-cache copilot responses for demo questions |
| Kafka too complex | Fall back to Redis pub/sub for MVP |
| Camera feed unavailable | Use pre-recorded video file fed through OpenCV |
| Real malware risky | Use EICAR test file + known safe samples from MalwareBazaar |